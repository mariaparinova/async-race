(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerPolicy&&(s.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?s.credentials="include":a.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(a){if(a.ep)return;a.ep=!0;const s=t(a);fetch(a.href,s)}})();function h(r){const{classes:e,isPrimary:t=!1,text:n,onClick:a,isDisabled:s=!1}=r;let i="btn";i+=t?" primary ":" secondary ",i+=e?.join(" ")||"";const o=document.createElement("button");return o.disabled=s,o.className=i,o.innerText=n,o.onclick=u=>u.preventDefault(),a&&o.addEventListener("click",a),o}class A{values;subscribers=[];constructor(e){this.values=e}subscribe(e){this.subscribers.push(e)}updateState(e){const t={...this.values,...e},n=[];this.subscribers.forEach(a=>{const s=a.key,i=this.values[s],o=t[s];Object.is(i,o)||n.push(a.callback)}),this.values={...t},n.forEach(a=>a())}}var B=(r=>(r.Garage="garage",r.Winners="winners",r))(B||{});const L=new A({page:"garage"});L.subscribe({key:"page",callback:()=>j.render()});function Z(){const r=h({classes:["to-winners"],isPrimary:!0,text:"to winners",onClick:()=>{L.updateState({page:B.Winners})}}),e=h({classes:["to-garage"],isPrimary:!0,text:"to garage",onClick:()=>{L.updateState({page:B.Garage})}}),t=document.createElement("div");t.className="race-action btn-container";const n=document.createElement("header");return n.classList.add("header"),n.append(r,e,t),n}var m=(r=>(r.Get="GET",r.Put="PUT",r.Post="POST",r.Patch="PATCH",r.Delete="DELETE",r))(m||{});const S="/garage",P="/winners",F="/engine";var N=(r=>(r[r.Ok=200]="Ok",r[r.Created=201]="Created",r[r.NotFound=404]="NotFound",r[r.TooManyRequests=429]="TooManyRequests",r[r.InternalServerError=500]="InternalServerError",r))(N||{});class V{baseUrl="http://127.0.0.1:3000";async getCar({id:e}){return(await this.#e({method:m.Get,endpoint:`${S}/${e}`})).json()}async getCars({page:e,limit:t}){const n=new URLSearchParams;return e&&n.set("_page",`${e}`),t&&n.set("_limit",`${t}`),(await this.#e({method:m.Get,endpoint:`${S}?${n.toString()}`})).json()}async createCar(e){return(await this.#e({method:m.Post,endpoint:`${S}`,body:e})).json()}async deleteCar({id:e}){if((await this.#e({method:m.Delete,endpoint:`${S}/${e}`})).status!==N.Ok)throw new Error("response code !== 200")}async updateCar(e){const t=await this.#e({method:m.Put,endpoint:`${S}/${e.id}`,body:e});if(t.status!==N.Ok)throw new Error("response code !== 200");return t.json()}async startStopCar({id:e,status:t}){const n=new URLSearchParams;n.set("id",`${e}`),n.set("status",t);const s=await(await this.#e({method:m.Patch,endpoint:`${F}?${n.toString()}`})).json();return{velocity:s.velocity,distance:s.distance}}async setCarToDriveMode({id:e}){const t=new URLSearchParams;t.set("id",`${e}`),t.set("status","drive");const n=await this.#e({method:m.Patch,endpoint:`${F}?${t.toString()}`});if(n.status===N.TooManyRequests)throw new Error("Drive already in progress");if(n.status===N.NotFound)throw new Error('Set engine status to "started" before');return await n.json()}async getWinners(e){const{page:t,limit:n,sort:a,order:s}=e,i=new URLSearchParams({_page:`${t}`,_limit:`${n}`});a&&i.set("_sort",a),s&&i.set("_order",s);const o=await this.#e({method:m.Get,endpoint:`${P}?${i.toString()}`}),u=await o.json(),d=o.headers.get("X-Total-Count");return{winners:u,totalWinners:d?+d:P.length}}async getWinner({id:e}){return(await this.#e({method:m.Get,endpoint:`${P}/${e}`})).json()}async createWinner(e){return await(await this.#e({method:m.Post,endpoint:P,body:e})).json()}async deleteWinner({id:e}){return this.#e({method:m.Delete,endpoint:`${P}/${e}`})}async updateWinner(e){return(await this.#e({method:m.Put,endpoint:`${P}/${e.id}`,body:e})).json()}async#e(e){const{method:t,endpoint:n,headers:a={},body:s}=e,i=`${this.baseUrl}${n}`;let o;s&&(o=JSON.stringify(s),a["Content-Type"]="application/json");try{return await fetch(i,{headers:a,method:t,body:o})}catch(u){throw console.error(`Error during request method ${t}, URL ${i}`),u}}}const l=new V,T=(r={})=>l.getCars(r),K=await T(),z={updateCars:K,carForUpdating:void 0,currentPage:1,amountOfCarsOnPage:7,"is-garage-rendered":!1},c=new A(z);c.subscribe({key:"updateCars",callback:()=>b.renderTracks()});c.subscribe({key:"updateCars",callback:()=>b.pagination.updateTotalItemsAmount(c.values.updateCars.length)});c.subscribe({key:"currentPage",callback:()=>b.renderTracks()});c.subscribe({key:"carForUpdating",callback:()=>b.updateFormInputUpdateCar()});c.subscribe({key:"carForUpdating",callback:()=>b.renderTracks()});c.subscribe({key:"is-garage-rendered",callback:()=>b.addRaceResetBtnToUi()});var $=(r=>(r.Started="started",r.Drive="drive",r.Stopped="stopped",r))($||{});function D(){return`<svg width="40" height="20" viewBox="0 0 40 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M14.4454 2.8984C12.0957 2.89217 9.44906 3.08117 6.36887 3.55547C6.00531 3.60633 2.50258 5.60437 1.55823 6.9834C0.613888 8.36251 0.290849 10.9876 0.290849 10.9876C0.035896 12.0626 0.190771 13.8395 0.261892 14.0122C0.357869 14.3863 0.900095 14.7002 1.8314 14.9272C1.94001 13.1999 3.37145 11.8539 5.10231 11.8518C6.91454 11.8518 8.38356 13.321 8.38356 15.133C8.38239 15.2777 8.37165 15.4222 8.3514 15.5655C8.3998 15.5662 8.45476 15.5675 8.5007 15.568L28.128 15.7312C28.0908 15.534 28.0718 15.3337 28.0711 15.133C28.0711 13.321 29.5403 11.8518 31.3524 11.8518C33.1646 11.8518 34.6336 13.321 34.6336 15.133C34.6336 15.3519 34.6118 15.5703 34.5683 15.7847L39.6695 15.8271C39.7777 13.9558 40.2323 11.9905 39.0934 10.354C38.6458 9.71085 36.4741 8.54617 30.9698 7.67484C28.1259 6.24667 25.3504 4.62738 22.3278 3.69944C19.9973 3.23719 17.4666 2.90636 14.4454 2.8984ZM13.0347 3.88147C13.5268 3.88508 13.9781 3.90526 14.3484 3.94791L14.9461 7.91429C11.5476 7.4965 8.08447 7.12162 6.25378 5.65843C6.28249 5.20726 6.90675 4.55412 7.60779 4.30442C8.00482 4.163 10.9027 3.86588 13.0348 3.88147H13.0347ZM15.8751 3.91001C17.9268 3.93167 20.9636 4.13068 23.053 5.05353C24.0539 5.51701 25.9383 6.60179 27.1986 7.55958L26.6777 8.42378C23.2565 8.26956 18.697 8.07901 16.8257 7.86761L15.8751 3.91001ZM5.10231 13.1643C4.58017 13.1643 4.07941 13.3717 3.71019 13.7409C3.34098 14.1101 3.13356 14.6109 3.13356 15.133C3.13356 15.6552 3.34098 16.1559 3.71019 16.5252C4.07941 16.8944 4.58017 17.1018 5.10231 17.1018C5.62445 17.1018 6.12521 16.8944 6.49443 16.5252C6.86364 16.1559 7.07106 15.6552 7.07106 15.133C7.07106 14.6109 6.86364 14.1101 6.49443 13.7409C6.12521 13.3717 5.62445 13.1643 5.10231 13.1643ZM31.3523 13.1643C30.8302 13.1643 30.3294 13.3717 29.9602 13.7409C29.591 14.1101 29.3836 14.6109 29.3836 15.133C29.3836 15.6552 29.591 16.1559 29.9602 16.5252C30.3294 16.8944 30.8302 17.1018 31.3523 17.1018C31.8745 17.1018 32.3752 16.8944 32.7444 16.5252C33.1136 16.1559 33.3211 15.6552 33.3211 15.133C33.3211 14.6109 33.1136 14.1101 32.7444 13.7409C32.3752 13.3717 31.8745 13.1643 31.3523 13.1643Z" fill="currentColor"/>
</svg>`}class q{trackEl;car;carEl;callbacks;engine;constructor(e,t={}){this.car=e,this.callbacks=t,this.carEl=this.createCarEl(),this.trackEl=document.createElement("div"),this.trackEl.className="track",this.trackEl.setAttribute("data-track-id",`${e.id}`),this.engine={velocity:0,distance:0}}createStartEl(){const e=document.createElement("div");e.className="car-container";const t=document.createElement("div");t.className="start-point",t.append(this.carEl),e.append(this.createGoStopBtnEl(),t);const n=document.createElement("div");return n.className="start-area",n.append(this.createEditBtnsEl(),e),n}createEditBtnsEl(){const e=h({isPrimary:!1,text:"select",onClick:()=>this.selectCar()}),t=h({isPrimary:!1,text:"remove",onClick:()=>this.removeCar()}),n=document.createElement("span");n.className="car-name",n.innerText=this.car.name;const a=document.createElement("div");return a.className="btn-container edit-btn",a.append(e,t,n),a}createGoStopBtnEl(){const e=async()=>{const i=this.trackEl.querySelector(".icon-btn.go"),o=this.trackEl.querySelector(".icon-btn.stop");i.disabled=!0,o.disabled=!1,await this.setCarToStartMode()},t=async()=>{const i=this.trackEl.querySelector(".icon-btn.go"),o=this.trackEl.querySelector(".icon-btn.stop");i.disabled=!1,o.disabled=!0,this.returnCarToStart(),await this.setCarToStopMode()},n=document.createElement("div");n.className="car-action";const a=h({classes:["go","icon-btn"],isPrimary:!1,text:"A",onClick:e}),s=h({classes:["stop","icon-btn"],isPrimary:!1,text:"B",onClick:t,isDisabled:!0});return n.append(a,s),n}createCarEl(){const e=document.createElement("div");return e.className="car-container-svg",e.style.color=this.car.color,e.innerHTML=D(),e}createFinishEl(){const e=document.createElement("img");e.className="img flag",e.src="./icons/flag.svg",e.alt="Finish icon";const t=document.createElement("div");return t.className="finish-area",t.append(e),t}createTrackEl(){return this.trackEl.append(this.createStartEl()),this.trackEl.append(this.createFinishEl()),this.trackEl}async removeCar(){const{id:e}=this.car;await l.deleteCar({id:e}),await l.deleteWinner({id:e}),this.callbacks.onRemoveCar&&this.callbacks.onRemoveCar()}async selectCar(){this.callbacks.onSelectCar&&this.callbacks.onSelectCar(this.car)}async setCarToStartMode(){const{id:e}=this.car,t=await l.startStopCar({id:e,status:$.Started});this.engine.velocity=t.velocity,this.engine.distance=t.distance,this.startCar(),await this.setCarToDriveMode()}async setCarToDriveMode(){const e=$.Drive,{id:t}=this.car;let n;try{n=await l.setCarToDriveMode({id:t,status:e})}catch(a){if(!(a instanceof Error)){console.error(`Type: "${a}" is not instance of Error`);return}if(a.message==="Drive already in progress")return;a.message==='Set engine status to "started" before'&&(await l.startStopCar({id:t,status:$.Started}),n=await l.setCarToDriveMode({id:t,status:e}))}n?.success||(this.stopCar(),await this.setCarToStopMode())}async setCarToStopMode(){await l.startStopCar({id:this.car.id,status:$.Stopped})}startCar(){const e=this.engine.distance/this.engine.velocity;this.carEl.style.transition=`margin-left ${e}ms linear`,this.carEl.style.marginLeft=`${this.getDistance()}px`}stopCar(){this.carEl.style.marginLeft=getComputedStyle(this.carEl).marginLeft,this.carEl.style.transition="none"}getDistance(){const e=this.trackEl.querySelector(".start-point"),t=this.trackEl.querySelector(".finish-area");(!e||!t)&&console.log("error during count distance");const n=this.trackEl.offsetWidth,a=e.offsetLeft+e.offsetWidth,s=this.carEl.offsetWidth;return n-a-s}returnCarToStart(){this.carEl.style.transition="margin-left 0.2s",this.carEl.style.marginLeft="0"}}class U{itemsOnPage;totalItems;currentPage;detailsEl;buttonsContainerEl;paginationCallbacks;constructor(e){const{totalItems:t,infoTitle:n="",itemsOnPage:a=10,paginationCallbacks:s={}}=e;this.totalItems=t,this.itemsOnPage=a,this.currentPage=1,this.detailsEl=document.createElement("div"),this.detailsEl.className="details",this.addItemDetailsEl({title:n,amount:this.totalItems,classes:n}),this.addItemDetailsEl({title:"page",amount:c.values.currentPage,classes:"page"}),this.paginationCallbacks=s,this.buttonsContainerEl=document.createElement("div"),this.buttonsContainerEl.className="pagination btn-container",this.addPaginationButtons()}addItemDetailsEl({title:e,amount:t,classes:n=""}){const a=document.createElement("div");a.className=`${n} details-item`;const s=document.createElement("span");s.className="title",s.innerText=`${e} `;const i=document.createElement("span");i.className="amount",i.innerText=`${t}`,a.append(s,i),this.detailsEl.append(a)}updateTotalItemsAmount(e){this.totalItems=e;const t=this.detailsEl.querySelector(".amount");if(!(t instanceof HTMLElement)){console.error('Can not find property "totalIitemsEl" during change pagination');return}t.innerText=`${this.totalItems}`,this.disableEnableBtns()}addPaginationButtons(){const e=h({isPrimary:!0,text:"previous",classes:["previous"],isDisabled:this.currentPage===1,onClick:n=>this.btnOnclickHandler(n)}),t=h({isPrimary:!0,text:"next",classes:["next"],isDisabled:this.currentPage===this.getTotalPageAmount(),onClick:n=>this.btnOnclickHandler(n)});this.buttonsContainerEl.append(e,t)}btnOnclickHandler(e){const t=this.paginationCallbacks,n=this.currentPage,a=e.target;if(!(a instanceof HTMLButtonElement)){console.error('can not find "buttonElem" during change pagination');return}a.classList.contains("previous")&&(this.updateCurrentPageNumber(n-1),t.prevBtnCallback&&t.prevBtnCallback()),a.classList.contains("next")&&(this.updateCurrentPageNumber(n+1),t.nextBtnCallback&&t.nextBtnCallback())}updateCurrentPageNumber(e){if(e<1||e>this.getTotalPageAmount()||e===this.currentPage)return;this.currentPage=e;const t=this.detailsEl.querySelector(".page .amount");if(!(t instanceof HTMLElement)){console.error('Can not find "totalItemsEl" during change pagination');return}t.innerText=`${e}`,this.disableEnableBtns()}getTotalPageAmount(){return Math.ceil(this.totalItems/this.itemsOnPage)}disableEnableBtns(){const{currentPage:e,buttonsContainerEl:t}=this,n=t.querySelector(".btn.previous"),a=t.querySelector(".btn.next");if(!(n instanceof HTMLButtonElement)||!(a instanceof HTMLButtonElement)){console.error('can not find "buttonElem" during change pagination');return}n.disabled=e===1,a.disabled=e===this.getTotalPageAmount()}}function M(r){const{type:e="text",id:t,name:n,labelText:a="",placeholder:s,onClick:i,onChange:o,onInput:u,onFocus:d,inputClassNames:E="",labelClassNames:f="",containerClassNames:C="",value:v,isDisabled:x=!1,isRequired:O=!1}=r,p=document.createElement("input");p.className=`input ${E}`,p.type=e,p.disabled=x,p.required=O;const y=document.createElement("label");y.className=`label ${f}`,y.innerText=a,t&&(p.id=t,y.htmlFor=t),n&&(p.name=n),s&&(p.placeholder=s),i&&(p.onclick=i),o&&(p.onchange=w=>{o(w)}),u&&(p.oninput=w=>{u(w)}),d&&(p.onfocus=w=>{d(w)}),v&&(p.value=v);const k=document.createElement("div");return k.className=`input-container ${C}`,k.append(p,y),k}function J(){return`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`}const W=["Toyota","BMW","Mercedes-Benz","Audi","Ford","Honda","Chevrolet","Nissan","Hyundai","Kia","Volkswagen","Lexus"];class X{garagePageEl;formEl;contentEl;pagination;btnRaceEl;btnResetEl;tracks;winnerId;constructor(){this.winnerId=void 0,this.tracks=[],this.pagination=new U({totalItems:c.values.updateCars.length,infoTitle:"cars",itemsOnPage:c.values.amountOfCarsOnPage,paginationCallbacks:{prevBtnCallback:()=>c.updateState({currentPage:this.pagination.currentPage}),nextBtnCallback:()=>c.updateState({currentPage:this.pagination.currentPage})}}),this.formEl=document.createElement("form"),this.formEl.className="form",this.addFormInputNewCar(),this.updateFormInputUpdateCar(),this.btnRaceEl=this.createRaceButton(),this.btnResetEl=this.createResetButton();const e=document.createElement("div");e.className="content",this.contentEl=e;const t=document.createElement("div");t.className="garage",this.garagePageEl=t,this.garagePageEl.ontransitionend=n=>this.makeRaceCompleted(n),this.garagePageEl.append(this.pagination.detailsEl,this.formEl,e,this.pagination.buttonsContainerEl),this.addGenerateCarsEl()}createRaceButton(){return h({classes:["race"],isPrimary:!0,text:"race",onClick:async()=>{this.winnerId=void 0,this.btnResetEl.disabled=!0,this.btnRaceEl.disabled=!0,this.tracks.forEach(t=>t.setCarToStartMode())}})}createResetButton(){return h({isPrimary:!0,text:"reset",onClick:async()=>{this.btnRaceEl.disabled=!1,this.tracks.forEach(n=>n.setCarToStopMode());const t=await T({page:this.pagination.currentPage,limit:this.pagination.itemsOnPage});c.updateState({updateCars:t})},isDisabled:!0})}addRaceResetBtnToUi(){const e=document.body.querySelector(".header .race-action.btn-container");if(!e||e.querySelector(".btn")){console.error("Error during race action buttons");return}e.append(this.btnRaceEl,this.btnResetEl)}async renderTracks(){const e=await T({page:this.pagination.currentPage,limit:this.pagination.itemsOnPage}),t={onRemoveCar:async()=>{const s=await T();c.updateState({updateCars:s})},onSelectCar:s=>{c.updateState({carForUpdating:s})}};this.tracks=e.map(s=>new q(s,t));const n=this.tracks.map(s=>s.createTrackEl()),a=this.contentEl.querySelector(".race-result");a&&a.remove(),this.contentEl.innerHTML="",this.contentEl.append(...n),this.btnRaceEl.disabled=!1,c.updateState({"is-garage-rendered":!0})}addFormInputNewCar(){const e=document.createElement("select");e.className="select",e.name="car-brands",W.forEach(i=>{const o=document.createElement("option");o.value=i,o.innerText=i,e.append(o)});const t=M({type:"color",id:"color",name:"color",inputClassNames:"color",value:"#E479F0"}),a=h({text:"create",onClick:async()=>{const i=this.formEl.querySelector('[name="car-brands"]'),o=this.formEl.querySelector('[name="color"]');if(!i||!o)throw new Error("Error during creating new car");const u=i.value,d=o.value;await l.createCar({name:u,color:d});const E=await T();c.updateState({updateCars:E})}}),s=document.createElement("div");s.className="item-form create",s.append(e,t,a),this.formEl.append(s)}updateFormInputUpdateCar(){const{formEl:e}=this;if(!e.querySelector(".update")){const o=M({id:"update-brand",name:"update-brand",inputClassNames:"update",value:"",isDisabled:!0}),u=M({type:"color",id:"update-color",name:"update-color",inputClassNames:"update-color",value:"#ffffff",isDisabled:!0}),E=h({text:"update",classes:["update"],onClick:async()=>{const{carForUpdating:C}=c.values,v=this.formEl.querySelector(".input.update"),x=v instanceof HTMLInputElement&&v.value?v.value:C.name,O=this.formEl.querySelector(".item-form.update .input.update-color"),p=O instanceof HTMLInputElement?O.value:C.color,y={id:C.id,name:x,color:p};await l.updateCar(y);const k=await l.getCar({id:y.id}),w=c.values.updateCars.findIndex(_=>_.id===k.id);c.values.updateCars[w]=k,this.updateTrack(k)},isDisabled:!0}),f=document.createElement("div");f.className="item-form update",f.append(o,u,E),this.formEl.append(f);return}const{carForUpdating:n}=c.values,a=e.querySelector(".input#update-brand"),s=e.querySelector(".input#update-color");if(!(a instanceof HTMLInputElement)||!(s instanceof HTMLInputElement)){console.error('error during updating input "update car"');return}a.value=n?.name||"",a.disabled=!n,s.value=n?.color||"#ffffff",s.disabled=!n;const i=e.querySelector(".btn.update");i instanceof HTMLButtonElement&&(i.disabled=!n)}updateTrack(e){const t=this.contentEl.querySelector(`[data-track-container-id="${e.id}"]`);t&&t.replaceWith(new q(e).createTrackEl())}addGenerateCarsEl(){async function e(){const a=[];for(let i=0;i<100;i+=1)a.push({name:W[Math.floor(Math.random()*W.length)],color:J()});await Promise.all(a.map(i=>l.createCar(i)));const s=await T();c.updateState({updateCars:s})}const t=h({isPrimary:!1,text:"generate cars",onClick:e}),n=this.garagePageEl.querySelector(".details");n instanceof HTMLDivElement&&n.append(t)}async makeRaceCompleted(e){if(this.winnerId)return;const t=e.target;if(!t||!t.classList.contains("car-container-svg"))return;const n=t.closest(".track"),a=n.dataset.trackId;if(!a){console.error(`Track element ${n} requires "id"`);return}const s=this.tracks.find(i=>i.car.id===+a);this.renderRaceResult({text:`${s?.car.name} went first [${e.elapsedTime.toFixed(2)}]s`}),this.winnerId=+a,await this.addUpdateWinner({id:this.winnerId,time:e.elapsedTime}),this.btnResetEl.disabled=!1}async addUpdateWinner(e){const{id:t,time:n}=e,a=await l.getWinner({id:t});if(a.id){const s=await l.getWinner({id:t});await l.updateWinner({id:t,wins:s.wins+1,time:Math.min(n,s.time)})}a.id||await l.createWinner({id:t,time:n,wins:1})}renderRaceResult({text:e}){const t=document.createElement("div");t.className="race-result",t.innerText=e,this.contentEl.append(t)}}const b=new X;var H=(r=>(r.Wins="wins",r.Time="time",r))(H||{}),R=(r=>(r.Asc="ASC",r.Desc="DESC",r))(R||{});const Q=r=>l.getWinners(r),Y={currentPage:1,sortBy:void 0,sortOrder:void 0},g=new A(Y);g.subscribe({key:"currentPage",callback:()=>I.renderWinners()});g.subscribe({key:"sortBy",callback:()=>I.renderWinners()});g.subscribe({key:"sortOrder",callback:()=>I.renderWinners()});class ee{tableEl;tbodyEl;theadEl;amountOfCellInRow;constructor(e){this.amountOfCellInRow=e.length,this.theadEl=document.createElement("thead"),this.theadEl.append(this.getTableRowEl(e.map(t=>this.getTableCellEl(t)))),this.tbodyEl=document.createElement("tbody"),this.tableEl=document.createElement("table"),this.tableEl.className="table",this.tableEl.append(this.theadEl,this.tbodyEl)}getTableRowEl(e){const t=document.createElement("tr");return e?.length&&t.append(...e),t}getTableCellEl(e){const t=e.kindOfCell||"td",n=document.createElement(t);return n.className=`${t} ${e.classes||""}`,typeof e.cellContent=="string"&&(n.innerText=e.cellContent),e.cellContent instanceof HTMLElement&&n.append(e.cellContent),e.onclickHandler&&(n.onclick=e.onclickHandler),n}}class te{winnersPageEl;contentEl;table;pagination;constructor(){this.pagination=new U({totalItems:1,infoTitle:"winners",itemsOnPage:10,paginationCallbacks:{prevBtnCallback:()=>g.updateState({currentPage:this.pagination.currentPage}),nextBtnCallback:()=>g.updateState({currentPage:this.pagination.currentPage})}}),this.table=new ee([{kindOfCell:"th",cellContent:"number",classes:""},{kindOfCell:"th",cellContent:"car",classes:""},{kindOfCell:"th",cellContent:"name",classes:""},{kindOfCell:"th",cellContent:"wins",classes:"wins",onclickHandler:()=>this.onHeaderClick("wins")},{kindOfCell:"th",cellContent:"best time, sec",classes:"time",onclickHandler:()=>this.onHeaderClick("time")}]),this.contentEl=this.table.tableEl;const e=document.createElement("div");e.classList.add("winners"),this.winnersPageEl=e,this.winnersPageEl.append(this.pagination.detailsEl,this.contentEl,this.pagination.buttonsContainerEl)}async renderWinners(){const{winners:e,totalWinners:t}=await Q({page:this.pagination.currentPage,limit:this.pagination.itemsOnPage,sort:g.values.sortBy,order:g.values.sortOrder});this.pagination.updateTotalItemsAmount(t);const n=e.map(d=>l.getCar({id:d.id})),a=await Promise.all(n),o=e.map((d,E)=>{const f=a[E],C=document.createElement("div");return C.style.color=f.color,C.innerHTML=D(),[{cellContent:`${E+1}`},{cellContent:C},{cellContent:f.name},{cellContent:`${d.wins}`},{cellContent:`${d.time.toFixed(2)}`}]}).map(d=>d.map(E=>this.table.getTableCellEl(E))).map(d=>this.table.getTableRowEl(d)),u=this.contentEl.querySelector("tbody");if(!(u instanceof HTMLElement)){console.error("Error during render winners");return}u.innerHTML="",u.append(...o)}onHeaderClick(e){let t=R.Asc,n;switch(e){case"wins":n=H.Wins;break;case"time":n=H.Time;break;default:return}g.values.sortBy===n&&(t=g.values.sortOrder===R.Asc?R.Desc:R.Asc),g.updateState({sortBy:n,sortOrder:t})}}const I=new te;class ne{rootAppEl;headerEl;outlet;constructor({rootAppEl:e}){const t=document.createElement("main");t.classList.add("main"),this.headerEl=Z(),this.outlet=t,this.rootAppEl=e,this.rootAppEl.append(this.headerEl,this.outlet)}async render(){if(!(this.outlet instanceof HTMLElement))return;this.outlet.innerHTML="";const e=L.values.page===B.Garage,t=L.values.page===B.Winners;if(e){const{garagePageEl:n}=b;await b.renderTracks(),this.outlet.append(n)}if(t){const{winnersPageEl:n}=I;await I.renderWinners(),this.outlet.append(n)}this.rootAppEl.classList.toggle("garage",e),this.rootAppEl.classList.toggle("winners",t)}}const G=document.getElementById("app");if(!(G instanceof HTMLElement))throw new Error("RootAppElement is not found");const j=new ne({rootAppEl:G});await j.render();
